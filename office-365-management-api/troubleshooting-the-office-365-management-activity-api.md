---
ms.technology: o365-service-communications
ms.TocTitle: Troubleshooting the Office 365 Management Activity API
title: Problembehandlung bei der Office 365-Verwaltungsaktivitäts-API
description: Enthält eine Zusammenfassung der am häufigsten gestellten Fragen, die der Microsoft-Support zu dieser API erhält.
ms.ContentId: 50822603-a1ec-a754-e7dc-67afe36bb1b0
ms.topic: reference (API)
ms.date: ''
localization_priority: Priority
ms.openlocfilehash: 218c0517697f1d71b1557f3b55a4c184fb52ec54
ms.sourcegitcommit: c9cb078e6c94bcf0bb28cb0fffef39302ec8c197
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 10/12/2020
ms.locfileid: "48425619"
---
# <a name="office-365-management-activity-api-faqs-and-troubleshooting"></a><span data-ttu-id="0b6e8-103">Häufig gestellte Fragen und Problembehandlung der Office 365-Verwaltungsaktivitäts-API</span><span class="sxs-lookup"><span data-stu-id="0b6e8-103">Office 365 Management Activity API FAQs and troubleshooting</span></span>

<span data-ttu-id="0b6e8-104">Die Office 365-Verwaltungsaktivitäts-API (auch bekannt als *einheitliche Überwachungs-API*) ist Teil der Office 365-Sicherheits- und Complianceangebote, die:</span><span class="sxs-lookup"><span data-stu-id="0b6e8-104">The Office 365 Management Activity API (also known as the *Unified Auditing API*) is a part of Office 365 security and compliance offerings, that:</span></span>

- <span data-ttu-id="0b6e8-105">Ermöglicht den programmgesteuerten Zugriff auf mehrere Überwachungspipeline-Arbeitslasten (wie SharePoint und Exchange)</span><span class="sxs-lookup"><span data-stu-id="0b6e8-105">Allows programmatic access to multiple auditing pipeline workloads (such as SharePoint and Exchange)</span></span>

- <span data-ttu-id="0b6e8-106">Ist die wichtigste Schnittstelle, die von einer Vielzahl von Drittanbieterprodukten zum Aggregieren und Indexieren von Überwachungsdaten verwendet wird</span><span class="sxs-lookup"><span data-stu-id="0b6e8-106">Is the main interface used by a variety of third-party vendor products to aggregate and index auditing data</span></span>

<span data-ttu-id="0b6e8-107">Die Verwaltungsaktivitäts-API sollte nicht mit der Office 365-Dienstkommunikations-API verwechselt werden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-107">The Management Activity API shouldn't be confused with the Office 365 Service Communications API.</span></span> <span data-ttu-id="0b6e8-108">Die Verwaltungsaktivitäts-API ist für die Überwachung der Endbenutzeraktivitäten in den verschiedenen Arbeitslasten gedacht.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-108">The Management Activity API is for auditing end user activities in the various workloads.</span></span> <span data-ttu-id="0b6e8-109">Die Dienstkommunikations-API ist für die Überwachung von Status und Nachrichten gedacht, die von den Diensten gesendet werden, die in Office 365 zur Verfügung stehen (z. B. Dynamics CRM oder Identity Service).</span><span class="sxs-lookup"><span data-stu-id="0b6e8-109">The Service Communications API is for auditing status and messages that are sent by the services that are available in Office 365 (such as Dynamics CRM or Identity Service).</span></span>

## <a name="frequently-asked-questions-about-the-office-365-management-activity-api"></a><span data-ttu-id="0b6e8-110">Häufig gestellte Fragen zur Office 365-Verwaltungsaktivitäts-API</span><span class="sxs-lookup"><span data-stu-id="0b6e8-110">Frequently asked questions about the Office 365 Management Activity API</span></span>

<span data-ttu-id="0b6e8-111">**Wie kann ich die Verwaltungsaktivitäts-API nutzen?**</span><span class="sxs-lookup"><span data-stu-id="0b6e8-111">**How do I onboard to the Management Activity API?**</span></span>

<span data-ttu-id="0b6e8-112">Informationen zu den ersten Schritten mit der Office 365-Verwaltungsaktivitäts-API finden Sie unter [Erste Schritte mit den Office 365-Verwaltungs-APIs](get-started-with-office-365-management-apis.md).</span><span class="sxs-lookup"><span data-stu-id="0b6e8-112">To get started with the Office 365 Management Activity API, see [Get started with Office 365 Management APIs](get-started-with-office-365-management-apis.md).</span></span>

<span data-ttu-id="0b6e8-113">**Was geschieht, wenn ich die Überwachung meiner Office 365-Organisation deaktivieren möchte? Erhalte ich weiterhin Ereignisse über die Verwaltungsaktivitäts-API?**</span><span class="sxs-lookup"><span data-stu-id="0b6e8-113">**What happens if I disable auditing for my Office 365 organization? Will I still get events via the Management Activity API?**</span></span>

<span data-ttu-id="0b6e8-114">Nein.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-114">No.</span></span><span data-ttu-id="0b6e8-115">Die einheitliche Überwachung von Office 365 muss für Ihre Organisation aktiviert sein, damit Datensätze über die Verwaltungsaktivitäts-API abgerufen werden können.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-115"> Office 365 unified auditing must be enabled for your organization to pull records via the Management Activity API.</span></span> <span data-ttu-id="0b6e8-116">Weitere Anweisungen finden Sie unter [Die Überwachungsprotokollsuche ein- oder ausschalten](https://docs.microsoft.com/microsoft-365/compliance/turn-audit-log-search-on-or-off).</span><span class="sxs-lookup"><span data-stu-id="0b6e8-116">For instructions, see [Turn audit log search on or off](https://docs.microsoft.com/microsoft-365/compliance/turn-audit-log-search-on-or-off).</span></span>

<span data-ttu-id="0b6e8-117">**Welche Ereignisse werden für einen bestimmten Office 365-Dienst überwacht?**</span><span class="sxs-lookup"><span data-stu-id="0b6e8-117">**What events are audited for a specific Office 365 service?**</span></span>

<span data-ttu-id="0b6e8-118">Die Dokumentation für das Office 365-Verwaltungsaktivitäts-API-Schema enthält eine umfassende Liste der Ereignisse.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-118">Office 365 Management Activity API schema documentation has a comprehensive list of events.</span></span> <span data-ttu-id="0b6e8-119">Einzelheiten hierzu finden Sie unter „Office 365-Verwaltungsaktivitäts-API – Schema“.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-119">For details, see Office 365 Management Activity API schema.</span></span> <span data-ttu-id="0b6e8-120">Eine Liste der Ereignisse für die meisten Office 365-Dienste, die überwacht werden, finden Sie auch im Abschnitt „Überwachte Aktivitäten“ in [Durchsuchen des Überwachungsprotokolls im Security & Compliance Center](https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance#audited-activities).</span><span class="sxs-lookup"><span data-stu-id="0b6e8-120">Also see the "Audited activities" section in [Search the audit log in the Security & Compliance Center](https://docs.microsoft.com/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance#audited-activities) for a list of events for most of the Office 365 services that are audited.</span></span>

<span data-ttu-id="0b6e8-121">**Gibt es Unterschiede in den Datensätzen, die von der Verwaltungsaktivitäts-API abgerufen werden, und den Datensätzen, die mit dem Überwachungsprotokoll-Suchtool im Microsoft 365 Compliance Center zurückgegeben werden?**</span><span class="sxs-lookup"><span data-stu-id="0b6e8-121">**Are there any differences in the records that are fetched by the Management Activity API versus the records that are returned by using the audit log search tool in the Microsoft 365 compliance center?**</span></span>

<span data-ttu-id="0b6e8-122">Von beiden Methoden werden identische Daten zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-122">The data that is returned by both methods is the same.</span></span> <span data-ttu-id="0b6e8-123">Der einzige Unterschied besteht darin, dass Sie mit der API nur Daten für die letzten 7 Tage abrufen können (weitere Details finden Sie in den nachfolgenden Fragen).</span><span class="sxs-lookup"><span data-stu-id="0b6e8-123">The only difference is that with the API, you can get data for the last 7 days only (more details in the questions below).</span></span> <span data-ttu-id="0b6e8-124">Wenn Sie das Überwachungsprotokoll im Security & Compliance Center durchsuchen (oder das entsprechende Cmdlet **Search-UnifiedAuditLog** im Exchange Online PowerShell verwenden), können Sie Daten für den Aufbewahrungszeitraum abrufen, der bei der Generierung der Daten gültig war (z. B. 90 Tage oder ein Jahr).</span><span class="sxs-lookup"><span data-stu-id="0b6e8-124">When searching the audit log in the Security & Compliance Center (or by using the corresponding **Search-UnifiedAuditLog** cmdlet in Exchange Online PowerShell), you can get data for the retention period in effect when the data is generated (for example, 90 days or one year).</span></span>

<span data-ttu-id="0b6e8-125">**Wie lange muss ich maximal warten, bevor eine Benachrichtigung zu einem bestimmten Office 365-Ereignis gesendet wird?**</span><span class="sxs-lookup"><span data-stu-id="0b6e8-125">**What is the maximum time I will have to wait before a notification is sent about a given Office 365 event?**</span></span>

<span data-ttu-id="0b6e8-126">Es gibt keine garantierte maximale Wartezeit für die Bereitstellung von Benachrichtigungen (es gibt kein SLA).</span><span class="sxs-lookup"><span data-stu-id="0b6e8-126">There is no guaranteed maximum latency for notification delivery (in other words, there is no SLA).</span></span> <span data-ttu-id="0b6e8-127">Normalerweise werden die meisten Benachrichtigungen innerhalb einer Stunde nach dem Ereignis gesendet.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-127">Typically, most notifications are sent within one hour of the event.</span></span> <span data-ttu-id="0b6e8-128">Häufig ist die Wartezeit viel kürzer, aber es kann länger dauern, da dies von der Arbeitsauslastung abhängt.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-128">Often the latency is much shorter, but this period might be longer since this varies from workload to workload.</span></span>

<span data-ttu-id="0b6e8-129">**Sind Webhook-Benachrichtigungen unmittelbarer?**</span><span class="sxs-lookup"><span data-stu-id="0b6e8-129">**Aren't webhook notifications more immediate?**</span></span>

<span data-ttu-id="0b6e8-130">Nein.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-130">No.</span></span> <span data-ttu-id="0b6e8-131">In letzter Zeit gab es längere Wartezeiten für Benachrichtigungen bei Verwendung eines Webhook als bei direkter Abfrage der API mit der `/content`-Operation.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-131">Recently, there have been longer wait times for notifications when using a webhook compared to querying the API directly with the `/content` operation.</span></span>

<span data-ttu-id="0b6e8-132">**Wie lange bleibt der Inhalt zum Abruf über die API verfügbar?**</span><span class="sxs-lookup"><span data-stu-id="0b6e8-132">**How long will the content remain available to fetch via the API?**</span></span>

<span data-ttu-id="0b6e8-133">Inhalte können während sieben Tagen nach Benachrichtigung über die Verfügbarkeit von Inhalten über die API abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-133">Content is available to fetch via the API for 7 days after the notification of the content availability.</span></span> <span data-ttu-id="0b6e8-134">Auch wenn sich die Benachrichtigung ungewöhnlich lange verzögert (beispielsweise bei einer Serviceunterbrechung), haben Sie dennoch 7 Tage nach der ersten Verfügbarkeit der Benachrichtigung, um das mit dem ursprünglichen Ereignis verknüpfte Inhalts-Blob herunterzuladen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-134">Even if the notification is delayed for an unusually long period (for example, in the case of a service interruption), you would still have 7 days after the first availability of the notification to download the content blob related to the originating event.</span></span>

<span data-ttu-id="0b6e8-135">**Kann ich die Verwaltungsaktivitäts-API für eine bestimmte Ereignis-ID oder einen bestimmten RecordType oder andere Eigenschaften im Inhalts-Blob abfragen?**</span><span class="sxs-lookup"><span data-stu-id="0b6e8-135">**Can I query the Management Activity API for a particular event ID or RecordType or other properties in the content blob?**</span></span>

<span data-ttu-id="0b6e8-136">Nein.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-136">No.</span></span> <span data-ttu-id="0b6e8-137">Die Verwaltungsaktivitäts-API bietet alle Ereignisdetails für ein bestimmtes Protokoll.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-137">The Management Activity API provides all the event details for a particular log.</span></span> <span data-ttu-id="0b6e8-138">Es kann zum Herunterladen der gesamten Details verwendet werden, und dann können Sie Ihre eigene Abfragelogik für die heruntergeladenen Daten implementieren. Verwenden Sie dazu beispielsweise eine benutzerdefinierte Anwendung oder ein Tool eines Drittanbieters.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-138">It can be used to download the entire details, and then you can implement your own query logic on the downloaded data; for example, by using a custom application or a third-party tool.</span></span>

<span data-ttu-id="0b6e8-139">**Wie kann ich feststellen, ob die Daten aus meiner vorhandenen Überwachungslösung, die Daten von der Verwaltungsaktivitäts-API sammelt, präzise und vollständig sind?**</span><span class="sxs-lookup"><span data-stu-id="0b6e8-139">**How do I know the data coming from my existing auditing solution, which collects data from the Management Activity API, is accurate and complete?**</span></span>

<span data-ttu-id="0b6e8-140">Die kurze Antwort lautet, dass Microsoft kein Protokoll zur Verfügung stellt, mit dem Sie eine bestimmte Anwendung oder Anwendung von Drittanbietern (ISV) überprüfen können.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-140">The short answer is that Microsoft doesn't provide any kind of a log that allows you to cross-check any given application or third-party (ISV) application.</span></span> <span data-ttu-id="0b6e8-141">Es gibt andere Microsoft-Sicherheitsprodukte, die ihre Daten aus derselben Pipeline erhalten, aber diese Produkte werden hier nicht behandelt und können nicht verwendet werden, um die Verwaltungsaktivitäts-API direkt zu prüfen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-141">There are other Microsoft security products that obtain their data from the same pipeline, but those products fall outside the scope of this discussion and can't be used to directly cross-check the Management Activity API.</span></span> <span data-ttu-id="0b6e8-142">Wenn Sie sich Sorgen über Diskrepanzen zwischen Ihrer vorhandenen Lösung und Ihren Erwartungen machen, sollten Sie die oben skizzierten Operationen implementieren.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-142">If you're concerned about discrepancies between what your existing solution is providing and what you expect, you should implement the operations illustrated above.</span></span> <span data-ttu-id="0b6e8-143">Jedoch kann dies schwierig sein, je nachdem, wie Ihr vorhandenes Tool oder Ihre vorhandene Lösung Daten auflistet und indiziert.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-143">But this can be difficult, depending on how your existing tool or solution lists and indexes data.</span></span> <span data-ttu-id="0b6e8-144">Wenn Ihre vorhandene Lösung nur Daten darstellt, die sortiert sind nach Erstellungszeit des tatsächlichen Ereignisses, dann gibt es keine Möglichkeit, die API nach Ereigniserstellungszeit abzufragen, um Ergebnissätze zu vergleichen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-144">If your existing solution only presents data sorted by the creation time of the actual event, there's no way to query the API by event creation time so that you can compare result sets.</span></span> <span data-ttu-id="0b6e8-145">In diesem Szenario müssten Sie die Inhalts-Blobs mit Benachrichtigungen mehrere Tage sammeln, sie manuell indizieren oder sortieren und dann einen manuellen Vergleich durchführen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-145">In this scenario, you'd have to collect the notified content blobs for several days, index or sort them manually, and then do a manual comparison.</span></span>

<span data-ttu-id="0b6e8-146">**Was ist der Einschränkungsgrenzwert für die Verwaltungsaktivitäts-API?**</span><span class="sxs-lookup"><span data-stu-id="0b6e8-146">**What is the throttling limit for the Management Activity API?**</span></span>

<span data-ttu-id="0b6e8-147">Allen Organisationen ist anfänglich eine Baseline von 2 000-Anforderungen pro Minute zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-147">All organizations are initially allocated a baseline of 2,000 requests per minute.</span></span> <span data-ttu-id="0b6e8-148">Das Einschränkungslimit wird dann basierend auf einer Kombination von Faktoren angepasst, einschließlich der Anzahl der Arbeitsplätze in der Organisation.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-148">The throttling limit is then adjusted based on a combination of factors, including the number of seats in the organization.</span></span> <span data-ttu-id="0b6e8-149">Zusätzlich erhalten Office 365 E5 and Microsoft 365 E5-Organisationen erhalten ungefähr doppelt so viel Bandbreite wie Nicht-E5-Organisationen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-149">Also, Office 365 E5 and Microsoft 365 E5 organizations will get approximately twice as much bandwidth as non-E5 organizations.</span></span> <span data-ttu-id="0b6e8-150">Zum Schutz des Diensts gibt es auch eine Obergrenze für die maximale Bandbreite.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-150">There will also be cap on the maximum bandwidth to protect the health of the service.</span></span>

> [!NOTE]
> <span data-ttu-id="0b6e8-151">Zwar kann jeder Mandant anfänglich bis zu 2.000 Anforderungen pro Minute senden, Microsoft kann aber keine Antwortrate garantieren.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-151">Even though each tenant can initially submit up to 2,000 requests per minute, Microsoft cannot guarantee a response rate.</span></span> <span data-ttu-id="0b6e8-152">Die Antwortrate hängt von verschiedenen Faktoren ab, z. B. der Leistung des Clientsystems, der Netzwerkkapazität und der Geschwindigkeit des Netzwerks.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-152">The response rate depends on various factors, such as client system performance, network capacity, and network speed.</span></span>

<span data-ttu-id="0b6e8-153">**In der Verwaltungsaktivitäts-API tritt ein Einschränkungsfehler auf. Was soll ich tun?**</span><span class="sxs-lookup"><span data-stu-id="0b6e8-153">**I'm encountering a throttling error in the Management Activity API. What should I do?**</span></span>

<span data-ttu-id="0b6e8-154">Öffnen Sie ein Ticket beim Microsoft-Support, fordern Sie einen neuen Einschränkungsgrenzwert an, und geben Sie dabei eine geschäftliche Begründung für die Erhöhung des Grenzwerts an.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-154">Open a ticket with Microsoft Support and request a new throttling limit, and include a business justification for increasing the limit.</span></span> <span data-ttu-id="0b6e8-155">Die Anforderung wird ausgewertet, und wenn sie akzeptiert wird, wird der Einschränkungsgrenzwert erhöht.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-155">We will evaluate the request, and if accepted, we will increase the throttling limit.</span></span>

<span data-ttu-id="0b6e8-156">**Warum werden in den Auditprotokollen für Azure Active Directory-Aktivitäten "TargetUpdatedProperties" nicht mehr in "ExtendedProperties" enthalten?**</span><span class="sxs-lookup"><span data-stu-id="0b6e8-156">**Why are TargetUpdatedProperties no longer in ExtendedProperties in the audit logs for Azure Active Directory activities?**</span></span>

<span data-ttu-id="0b6e8-157">"TargetUpdatedProperties" wurden in "ExtendedProperties" angezeigt.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-157">TargetUpdatedProperties were appearing in ExtendedProperties.</span></span> <span data-ttu-id="0b6e8-158">Sie wurden jedoch aus ExtendedProperties entfernt und werden nun in ModifiedProperties angezeigt.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-158">However, they have been removed from ExtendedProperties and now appear in ModifiedProperties.</span></span>

## <a name="troubleshooting-the-office-365-management-activity-api"></a><span data-ttu-id="0b6e8-159">Problembehandlung bei der Office 365-Verwaltungsaktivitäts-API</span><span class="sxs-lookup"><span data-stu-id="0b6e8-159">Troubleshooting the Office 365 Management Activity API</span></span>

<span data-ttu-id="0b6e8-160">Jeder, der die Office 365-Verwaltungsaktivitäts-API verwendet, sollte wissen, dass es keine Abfrage nach Ereignisspezifika gibt, wie Datum des Ereignisses, von welcher Websitesammlung ein Ereignis ausgelöst wurde oder Ereignistyp.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-160">One thing that should be made clear for anyone who's getting started with the Office 365 Management Activity API is that there is no concept of querying by event specifics, such as date that the event occurred, which site collection an event might have been fired from, or the type of event.</span></span> <span data-ttu-id="0b6e8-161">Stattdessen erstellen Sie Abonnements für spezielle Arbeitslasten (beispielsweise SharePoint oder Azure AD), und jedes Abonnement ist mandantenspezifisch.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-161">Instead, you create subscriptions to specific workloads (for example, SharePoint or Azure AD) and each subscription is per tenant.</span></span>

<span data-ttu-id="0b6e8-162">In den folgenden Abschnitten werden die am häufigsten gestellten Fragen zusammengefasst, die Kunden über die Office 365-Verwaltungsaktivitäts-API haben:</span><span class="sxs-lookup"><span data-stu-id="0b6e8-162">The following sections summarizes the most common questions that customers have in using the Office 365 Management Activity API:</span></span>

- [<span data-ttu-id="0b6e8-163">Fragen zu Drittanbietertools und -clients</span><span class="sxs-lookup"><span data-stu-id="0b6e8-163">Questions about third-party tools and clients</span></span>](#questions-about-third-party-tools-and-clients)

- [<span data-ttu-id="0b6e8-164">Aktivieren der einheitliche Überwachungsprotokollierung in Office 365</span><span class="sxs-lookup"><span data-stu-id="0b6e8-164">Enabling unified audit logging in Office 365</span></span>](#enabling-unified-audit-logging-in-office-365)

- [<span data-ttu-id="0b6e8-165">Herstellen einer Verbindung mit der API</span><span class="sxs-lookup"><span data-stu-id="0b6e8-165">Connecting to the API</span></span>](#connecting-to-the-api)

- [<span data-ttu-id="0b6e8-166">Prüfen Ihrer Abonnements</span><span class="sxs-lookup"><span data-stu-id="0b6e8-166">Checking your subscriptions</span></span>](#checking-your-subscriptions)

- [<span data-ttu-id="0b6e8-167">Erstellen eines neuen Abonnements</span><span class="sxs-lookup"><span data-stu-id="0b6e8-167">Creating a new subscription</span></span>](#creating-a-new-subscription)

- [<span data-ttu-id="0b6e8-168">Verwenden von Webhooks</span><span class="sxs-lookup"><span data-stu-id="0b6e8-168">Using webhooks</span></span>](#using-webhooks)

- [<span data-ttu-id="0b6e8-169">Anfordern von Inhalts-Blobs und Drosselung</span><span class="sxs-lookup"><span data-stu-id="0b6e8-169">Requesting content blobs and throttling</span></span>](#requesting-content-blobs-and-throttling)

<span data-ttu-id="0b6e8-170">Wir zeigen eine Auswahl einfacher PowerShell-Skripts, mit denen Sie die gängigsten Fragen von Kunden beantworten oder eine benutzerdefinierte Lösung durch Demonstration der wichtigsten Operationen implementieren können.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-170">We'll show a selection of simple PowerShell scripts that can help you answer the most common questions asked by customers or get you started implementing a custom solution by demonstrating the main operations.</span></span> <span data-ttu-id="0b6e8-171">Nicht alle Operationen sind in diesen Abschnitten beschrieben, aber sie sind alle unter Office 365-Verwaltungsaktivitäts-API – Referenz aufgelistet.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-171">Not all the operations are explained in these sections, but they are all listed in Office 365 Management Activity API reference.</span></span>

### <a name="questions-about-third-party-tools-and-clients"></a><span data-ttu-id="0b6e8-172">Fragen zu Drittanbietertools und -clients</span><span class="sxs-lookup"><span data-stu-id="0b6e8-172">Questions about third-party tools and clients</span></span>

<span data-ttu-id="0b6e8-173">Die häufigsten Fragen stammen von Kunden, die Drittanbieterprodukte zum Herunterladen und Aggregieren von Überwachungsdaten verwenden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-173">The most common category of questions come from customers using third-party products to download and aggregate auditing data.</span></span> <span data-ttu-id="0b6e8-174">Je nach Drittanbieterprodukt haben Kunden Probleme mit der Einrichtung oder sind mit Unterbrechungen oder Inkonsistenzen in Bezug auf die Daten in diesen Produkten konfrontiert.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-174">Depending on the third-party product, customers may encounter difficulty with the setup or experience an interruption or an inconsistency in the data exposed in those products.</span></span> <span data-ttu-id="0b6e8-175">Solche Kunden sollten sich zunächst an den Support des Anbieters wenden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-175">Here it should be stated that the first action such customers should take is to contact their vendor's support organization.</span></span> <span data-ttu-id="0b6e8-176">Normalerweise ist eine mandantenspezifische Lieferantenkonfiguration oder ein Dienstproblem die Ursache von Kundenreklamationen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-176">Typically, a tenant-specific vendor configuration or service problem is the cause of customer complaints.</span></span>

### <a name="enabling-unified-audit-logging-in-office-365"></a><span data-ttu-id="0b6e8-177">Aktivieren der einheitliche Überwachungsprotokollierung in Office 365</span><span class="sxs-lookup"><span data-stu-id="0b6e8-177">Enabling unified audit logging in Office 365</span></span>

<span data-ttu-id="0b6e8-178">Wenn Sie gerade eine App eingerichtet haben, die versucht, die Verwaltungsaktivitäts-API zu verwenden, und dies nicht funktioniert, stellen Sie sicher, dass Sie die einheitliche Überwachungsprotokollierung für Ihre Office 365-Organisation aktiviert haben.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-178">If you've just set up an app that's trying to use the Management Activity API and it's not working, be sure that you've enabled unified audit logging for your Office 365 organization.</span></span> <span data-ttu-id="0b6e8-179">Dazu aktivieren Sie das Office 365-Überwachungsprotokoll.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-179">You do this by turning on the Office 365 audit log.</span></span> <span data-ttu-id="0b6e8-180">Weitere Anweisungen finden Sie unter [Aktivieren oder Deaktivieren der Office 365-Überwachungsprotokollsuche](https://docs.microsoft.com/office365/securitycompliance/turn-audit-log-search-on-or-off).</span><span class="sxs-lookup"><span data-stu-id="0b6e8-180">For instructions, see [Turn Office 365 audit log search on or off](https://docs.microsoft.com/office365/securitycompliance/turn-audit-log-search-on-or-off).</span></span>

<span data-ttu-id="0b6e8-181">Wenn die einheitliche Überwachung nicht aktiviert ist, wird in der Regel eine Fehlermeldung angezeigt, die folgende Zeichenfolge enthält: `Microsoft.Office.Compliance.Audit``.DataServiceException: Tenant <tenantID> does not exist.`</span><span class="sxs-lookup"><span data-stu-id="0b6e8-181">If unified auditing isn't enabled, you will typically receive an error that contains the following string: `Microsoft.Office.Compliance.Audit``.DataServiceException: Tenant <tenantID> does not exist.`</span></span>

### <a name="connecting-to-the-api"></a><span data-ttu-id="0b6e8-182">Herstellen einer Verbindung mit der API</span><span class="sxs-lookup"><span data-stu-id="0b6e8-182">Connecting to the API</span></span>

<span data-ttu-id="0b6e8-183">Die meisten Anwendungen stellen mit einem einfachen OAuth2-Fluss mit Client-Anmeldeinformationen eine Verbindung zur API her.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-183">Most applications connect to the API using a straightforward Client Credentials OAuth2 flow.</span></span> <span data-ttu-id="0b6e8-184">Daher ist der erste Schritt das Erstellen einer Azure AD-Anwendung, die die Berechtigungen für den Zugriff auf die Daten der Verwaltungsaktivitäts-API hat.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-184">Therefore, the first step is to create an Azure AD application that has the permissions needed to access the Management Activity API data.</span></span> <span data-ttu-id="0b6e8-185">In diesem Artikel werden nicht die Schritte zum Erstellen einer Azure AD-App-Registrierung erläutert.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-185">It's outside the scope of this article to explain the steps to create an Azure AD App registration.</span></span> <span data-ttu-id="0b6e8-186">Weitere Informationen finden Sie unter [Registrieren Ihrer Anwendung mit Ihrem Azure Active Directory-Mandanten](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications).</span><span class="sxs-lookup"><span data-stu-id="0b6e8-186">For more information, see [Register your application with your Azure Active Directory tenant](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications).</span></span>

#### <a name="azure-application-permissions"></a><span data-ttu-id="0b6e8-187">Azure-Anwendungsberechtigungen</span><span class="sxs-lookup"><span data-stu-id="0b6e8-187">Azure application permissions</span></span>

<span data-ttu-id="0b6e8-188">Die drei Berechtigungen, die derzeit für die Office 365-Verwaltungsaktivitäts-API verwendet werden, sind:</span><span class="sxs-lookup"><span data-stu-id="0b6e8-188">The three permissions currently used for the Office 365 Management Activity API are:</span></span>

1. <span data-ttu-id="0b6e8-189">Lesen der Aktivitätsdaten für Ihre Organisation</span><span class="sxs-lookup"><span data-stu-id="0b6e8-189">Read activity data for your organization</span></span>

2. <span data-ttu-id="0b6e8-190">Lesen der Dienstintegritätsinformationen für Ihre Organisation</span><span class="sxs-lookup"><span data-stu-id="0b6e8-190">Read service health information for your organization</span></span>

3. <span data-ttu-id="0b6e8-191">Lesen der Data Loss Prevention(DLP)-Richtlinienereignisse, einschließlich der erkannten vertraulichen Informationen</span><span class="sxs-lookup"><span data-stu-id="0b6e8-191">Read Data Loss Prevention (DLP) policy events, including detected sensitive information</span></span>

> [!NOTE]
> <span data-ttu-id="0b6e8-192">Sie sollten die Anwendungsberechtigungen und die delegierten Berechtigungen für mindestens die ersten beiden der obigen Berechtigungsgruppen aktivieren.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-192">You should enable both the Application Permissions and the Delegated Permissions for at least the first two of the above permission sets.</span></span> <span data-ttu-id="0b6e8-193">Das Lesen der DLP-Richtlinienereignisse ist nur erforderlich, wenn Sie an den DLP-Arbeitslasten interessiert sind.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-193">Read DLP policy events will only be necessary if you are interested in the DLP workloads.</span></span>

#### <a name="getting-an-access-token"></a><span data-ttu-id="0b6e8-194">Abrufen eines Zugriffstokens</span><span class="sxs-lookup"><span data-stu-id="0b6e8-194">Getting an access token</span></span>

<span data-ttu-id="0b6e8-195">Das folgende PowerShell-Skript verwendet die App-ID und einen geheimen Clientschlüssel, um das OAuth2-Token vom Authentifizierungsendpunkt der Verwaltungsaktivitäts-API abzurufen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-195">The following PowerShell script uses the App ID and a Client Secret to obtain the OAuth2 token from the Management Activity API authentication endpoint.</span></span> <span data-ttu-id="0b6e8-196">Es platziert dann das Zugriffstoken in der `$headerParams`-Array-Variable, die Sie an Ihre HTTP-Anforderung anhängen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-196">It then places the access token into the `$headerParams` array variable, which you'll attach to your HTTP request.</span></span> <span data-ttu-id="0b6e8-197">Verwenden Sie für den Wert für den API-Endpunkt (in der $resource-Variable) einen der folgenden Werte basierend auf dem Microsoft 365- oder Office 365-Abonnementplan Ihrer Organisation:</span><span class="sxs-lookup"><span data-stu-id="0b6e8-197">For the value for the API endpoint (in the $resource variable) use one of the following values based on your organization's Microsoft 365 or Office 365 subscription plan:</span></span>

- <span data-ttu-id="0b6e8-198">Enterprise-Plan: `manage.office.com`</span><span class="sxs-lookup"><span data-stu-id="0b6e8-198">Enterprise plan: `manage.office.com`</span></span>

- <span data-ttu-id="0b6e8-199">GCC-Government-Plan: `manage-gcc.office.com`</span><span class="sxs-lookup"><span data-stu-id="0b6e8-199">GCC government plan: `manage-gcc.office.com`</span></span>

- <span data-ttu-id="0b6e8-200">GCC High Government-Plan: `manage.office365.us`</span><span class="sxs-lookup"><span data-stu-id="0b6e8-200">GCC High government plan: `manage.office365.us`</span></span>

- <span data-ttu-id="0b6e8-201">DoD Government-Plan: `manage.protection.apps.mil`</span><span class="sxs-lookup"><span data-stu-id="0b6e8-201">DoD government plan: `manage.protection.apps.mil`</span></span>

```powershell
# Create app of type Web app / API in Azure AD, generate a Client Secret, and update the client id and client secret here
$ClientID = "<YOUR_APPLICATION_ID"
$ClientSecret = "<YOUR_CLIENT_SECRET>"
$loginURL = "https://login.microsoftonline.com/"
$tenantdomain = "<YOUR_DOMAIN>.onmicrosoft.com"
# Get the tenant GUID from Properties | Directory ID under the Azure Active Directory section. For $resource, use one of these endpoint values based on your subscription plan: Enterprise - manage.office.com; GCC - manage-gcc.office.com; GCC High: manage.office365.us; DoD: manage.protection.apps.mil
$TenantGUID = "<YOUR_TENANT_GUID>"
$resource = "https://<YOUR_API_ENDPOINT>"
# auth
$body = @{grant_type="client_credentials";resource=$resource;client_id=$ClientID;client_secret=$ClientSecret}
$oauth = Invoke-RestMethod -Method Post -Uri $loginURL/$tenantdomain/oauth2/token?api-version=1.0 -Body $body
$headerParams = @{'Authorization'="$($oauth.token_type) $($oauth.access_token)"} 
```

<span data-ttu-id="0b6e8-202">Die `$oauth`-Variable enthält das Antwortobjekt, das mehrere Eigenschaften einschließlich des Zugriffstokens umfasst.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-202">The `$oauth` variable will contain the response object, which has several properties including the access token.</span></span> <span data-ttu-id="0b6e8-203">Beispiel für eine Antwort:</span><span class="sxs-lookup"><span data-stu-id="0b6e8-203">Here's an example of a response:</span></span>

```json
token_type     : Bearer
expires_in     : 3599
ext_expires_in : 0
expires_on     : 1508285860
not_before     : 1508281960
resource       : https://manage.office.com
access_token   : eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IjJLVmN1enFBaWRPTHFXU2FvbDd3Z0ZSR0NZbyIsImtpZCI6IjJLVmN1enFBaWRPTHFXU2FvbDd3Z0ZSR0NZbyJ9.eyJhdWQiOiJodHRwczov…
```

### <a name="checking-your-subscriptions"></a><span data-ttu-id="0b6e8-204">Prüfen Ihrer Abonnements</span><span class="sxs-lookup"><span data-stu-id="0b6e8-204">Checking your subscriptions</span></span>

<span data-ttu-id="0b6e8-205">Wenn eine Unterbrechung im Datenfluss zu einem vorhandenen Client oder einer vorhandenen Lösung der Verwaltungsaktivitäts-API auftritt, gibt es evtl. ein Problem mit Ihrem Abonnement.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-205">If you've experienced an interruption in data flowing to an existing Management Activity API client or solution, you might wonder if something happened to your subscription.</span></span> <span data-ttu-id="0b6e8-206">Wenn Sie Ihre aktiven Abonnements prüfen möchten, fügen Sie Folgendes zum vorherigen Skript hinzu:</span><span class="sxs-lookup"><span data-stu-id="0b6e8-206">To check your active subscriptions, add the following to the previous script:</span></span>

```powershell
Invoke-WebRequest -Headers $headerParams -Uri "$resource/api/v1.0/$tenantGUID/activity/feed/subscriptions/list" 
```

#### <a name="sample-response"></a><span data-ttu-id="0b6e8-207">Beispielantwort</span><span class="sxs-lookup"><span data-stu-id="0b6e8-207">Sample response</span></span>

```json
StatusCode        : 200
Status Description : OK
Content           : [{"contentType":"Audit.Exchange","status":"enabled","webhook":null},{"contentType":"Audit.SharePoint","status":"enabled","webhook":{"authId":"","address":"https://mvcwebapiwebhookreceiver.azurewebsite...
RawContent        : HTTP/1.1 200 OK
                    Pragma: no-cache
                    Content-Length: 266
                    Cache-Control: no-cache
                    Content-Type: application/json; charset=utf-8
                    Expires: -1
                    Server: Microsoft-IIS/8.5,Microsoft-IIS/8.5
                    X-AspNet-Versi...
Forms             : {}
Headers           : {[Pragma, no-cache], [Content-Length, 266], [Cache-Control, no-cache], [Content-Type, application/json; charset=utf-8]...}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : mshtml.HTMLDocumentClass
RawContentLength  : 266
```

<span data-ttu-id="0b6e8-208">Das bedeutet, dass für den Mandanten sowohl Audit.Exchange- als auch Audit.SharePoint-Abonnements aktiviert sind.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-208">This says that the tenant has both Audit.Exchange and Audit.SharePoint subscriptions enabled.</span></span> <span data-ttu-id="0b6e8-209">Das Exchange-Abonnement verfügt nicht über einen aktivierten Webhook (null), und das SharePoint-Abonnement hat einen aktivierten Webhook, wobei die Adresse des registrierten Endpunkts angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-209">The Exchange subscription has no webhook enabled (null) and the SharePoint subscription has a webhook enabled with the address of the registered endpoint shown.</span></span>

### <a name="creating-a-new-subscription"></a><span data-ttu-id="0b6e8-210">Erstellen eines neuen Abonnements</span><span class="sxs-lookup"><span data-stu-id="0b6e8-210">Creating a new subscription</span></span>

<span data-ttu-id="0b6e8-211">Um ein neues Abonnement zu erstellen, verwenden Sie die /start-Operation.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-211">To create a new subscription, you use the /start operation.</span></span> <span data-ttu-id="0b6e8-212">Verwenden Sie für den API-Endpunkt einen der folgenden Werte basierend auf Ihrem Abonnementplan:</span><span class="sxs-lookup"><span data-stu-id="0b6e8-212">For the API endpoint, use one of these values base on your subscription plan:</span></span>

- <span data-ttu-id="0b6e8-213">Enterprise-Plan: `manage.office.com`</span><span class="sxs-lookup"><span data-stu-id="0b6e8-213">Enterprise plan: `manage.office.com`</span></span>

- <span data-ttu-id="0b6e8-214">GCC-Government-Plan: `manage-gcc.office.com`</span><span class="sxs-lookup"><span data-stu-id="0b6e8-214">GCC government plan: `manage-gcc.office.com`</span></span>

- <span data-ttu-id="0b6e8-215">GCC High Government-Plan: `manage.office365.us`</span><span class="sxs-lookup"><span data-stu-id="0b6e8-215">GCC High government plan: `manage.office365.us`</span></span>

- <span data-ttu-id="0b6e8-216">DoD Government-Plan: `manage.protection.apps.mil`</span><span class="sxs-lookup"><span data-stu-id="0b6e8-216">DoD government plan: `manage.protection.apps.mil`</span></span>

```powershell
Invoke-WebRequest -Method Post -Headers $headerParams -Uri "https://<YOUR_API_ENDPOINT>/api/v1.0/$tenantGUID/activity/feed/subscriptions/start?contentType=Audit.AzureActiveDirectory"

> [!NOTE]
> Remember that `$headerParams` was populated in the first part of the script listed in the [Connecting to the API](#connecting-to-the-api) section in this article.

The previous code will create a new subscription to the Audit.AzureActiveDirectory content type, with a webhook that is null. You can then check your subscriptions using the code in the [Checking your subscriptions](#checking-your-subscriptions) section in this article.

## Checking content availability

To check what content blobs were created during a certain period, you can add the following line to the script in the “Connecting to the API” section.

```powershell
Invoke-WebRequest -Method GET -Headers $headerParams -Uri "$resource/api/v1.0/$tenantGUID/activity/feed/subscriptions/content?contentType=Audit.SharePoint"
```

<span data-ttu-id="0b6e8-217">Im vorherigen Beispiel werden alle Benachrichtigungen empfangen, die heute verfügbar wurden, das heißt, von 12:00 Uhr UTC bis jetzt.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-217">The previous example will get all the content notifications that became available today, which means from 12:00 AM UTC to the current time.</span></span> <span data-ttu-id="0b6e8-218">Wenn Sie einen anderen Zeitraum angeben möchten (unter Berücksichtigung der Tatsache, dass der maximale Abfragezeitraum 24 Stunden beträgt), fügen Sie die Parameter *starttime* und *endtime* zum URI hinzu; beispielsweise:</span><span class="sxs-lookup"><span data-stu-id="0b6e8-218">If you want to specify a different time period (keeping in mind that the maximum period for which you can query is 24 hours), add the *starttime* and *endtime* parameters to the URI; for example:</span></span>

```powershell
Invoke-WebRequest -Method GET -Headers $headerParams -Uri "$resource/api/v1.0/$tenantGUID/activity/feed/subscriptions/content?contentType=Audit.SharePoint&startTime=2017-10-13T00:00&endTime=2017-10-13T11:59"
```

> [!NOTE]
> <span data-ttu-id="0b6e8-219">Sie müssen die Parameter *starttime* und *endtime* gemeinsam verwenden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-219">You must use either both *starttime* and *endtime* parameters or neither.</span></span>

```json
[{      "contentUri" : "https://<your_API_endpoint>/api/v1.0/<your_tenant_guid>/activity/feed/audit/20171014180051748005825$20171014180051748005825$audit_sharepoint$Audit_SharePoint",
        "contentId" : "20171014180051748005825$20171014180051748005825$audit_sharepoint$Audit_SharePoint",
        "contentType" : "Audit.SharePoint",
        "contentCreated" : "2017-10-13T18:00:51.748Z",
        "contentExpiration" : "2017-10-20T18:00:51.748Z",
}]
```

> [!IMPORTANT]
>
> - <span data-ttu-id="0b6e8-220">Die *ContentUri*-Eigenschaft ist der URI, von dem Sie das Inhalts-Blob abrufen können.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-220">The *contentUri* property is the URI from which you can retrieve the content blob.</span></span> <span data-ttu-id="0b6e8-221">Das Blob selbst enthält die Ereignisdetails; es enthält Details zu 1 – N-Ereignissen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-221">The blob itself is what contains the event details; it will contain details about 1 – N events.</span></span> <span data-ttu-id="0b6e8-222">Selbst wenn 30 JSON-Objekte in der Sammlung vorhanden sind, sind evtl. viel mehr Ereignisse in diesen 30 Inhalts-URIs aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-222">While there may be 30 JSON objects in the collection, there may be many more events detailed in those 30 content URIs.</span></span>
>
> - <span data-ttu-id="0b6e8-223">Die *ContentCreated*-Eigenschaft ist nicht das Datum, an dem das Ereignis mit der Benachrichtigung erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-223">The *contentCreated* property is not the date that the event being notified was created.</span></span> <span data-ttu-id="0b6e8-224">Dies ist das Datum, an dem die Benachrichtigung erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-224">This is the date the notification was created.</span></span> <span data-ttu-id="0b6e8-225">Die Ereignisse in diesem Blob wurden möglicherweise deutlich vor dem Inhalts-Blob erstellt.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-225">The events detailed in that blob may have been created well before the content blob was created.</span></span> <span data-ttu-id="0b6e8-226">Daher können Sie die API niemals direkt für Ereignisse abfragen, die in einem bestimmten Zeitraum aufgetreten sind.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-226">Therefore, you can never query the API directly for events that occurred within any given period.</span></span>

#### <a name="paging-contents-for-busy-tenants"></a><span data-ttu-id="0b6e8-227">Auslagern von Inhalten für aktive Mandanten</span><span class="sxs-lookup"><span data-stu-id="0b6e8-227">Paging contents for busy tenants</span></span>

<span data-ttu-id="0b6e8-228">Für viele größere Office 365-Mandanten werden Tausende von Ereignissen pro Stunde generiert.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-228">Many larger Office 365 tenants have thousands of events being generated every hour.</span></span> <span data-ttu-id="0b6e8-229">Wenn dies bei Ihrer Organisation der Fall ist und Sie versuchen, eine Abfrage für einen 24-Stunden-Zeitraum wie im vorstehenden Beispiel auszuführen, müssen Sie evtl. mehr Benachrichtigungen abrufen als in einer Antwort zurückgegeben werden können.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-229">If this is the case with your organization, and you try to execute a query for a 24-hour period like in the example above, you may need to retrieve more notifications than can be returned in one response.</span></span> <span data-ttu-id="0b6e8-230">In diesem Fall müssen Sie eine logische Schleife eines bestimmten Typs implementieren, wenn Sie die Antwortheader für den Headerwert **NextPageUrl:** prüfen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-230">In this case, you'll need to implement a logical loop of some kind, each time checking the response headers for the **NextPageUrl:** header value.</span></span> <span data-ttu-id="0b6e8-231">Im Abschnitt „Paginierung“ in der Referenz zur Office 365-Verwaltungsaktivitäts-API finden Sie weitere Details.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-231">See the Pagination section in the Office 365 Management Activity API reference for more details.</span></span>

```powershell
IF the NextPageUrl header is present in the response... 

THEN issue a new request substituting the Uri parameter in the above Invoke-WebRequest example for the value of the NextPageUrl header...
 
ELSE exit the loop
```

<span data-ttu-id="0b6e8-232">Es ist schwierig, diesen Schleifencode zu testen, wenn Sie keinen aktiven Mandanten haben.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-232">It will be difficult to test this looping code unless you have a very active tenant.</span></span> <span data-ttu-id="0b6e8-233">In unseren Tests haben wir versucht, verschiedene Tausende Update-Operationen in einem Skript auszuführen und konnten keine ausreichende Anzahl an Benachrichtigungen generieren, um das Senden des **NextPageUrl**-Headers anzufordern.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-233">In our testing, we tried to execute several thousand update operations in a script and was unable to generate a large enough number of notifications to require the **NextPageUrl** header to be sent.</span></span>

### <a name="using-webhooks"></a><span data-ttu-id="0b6e8-234">Verwenden von Webhooks</span><span class="sxs-lookup"><span data-stu-id="0b6e8-234">Using webhooks</span></span>

<span data-ttu-id="0b6e8-235">Es gibt zwei Möglichkeiten, eine Benachrichtigung zu erhalten, dass Inhalts-Blobs erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-235">There two ways to get a notification that content blobs have been created.</span></span> <span data-ttu-id="0b6e8-236">Der *Push*-Ansatz wird mit einem Webhook-Endpunkt implementiert. Bei diesem handelt es sich um eine Webanwendung, die Sie erstellen und selbst oder auf einer Cloudplattform hosten.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-236">The *push* approach is implemented with a webhook endpoint, which is a web application that you create and host yourself or on a cloud platform.</span></span> <span data-ttu-id="0b6e8-237">Sie registrieren den Webhook beim Erstellen eines Abonnements für einen überwachten Inhaltstyp.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-237">You register the webhook at the time you create a subscription to an audited content type.</span></span> <span data-ttu-id="0b6e8-238">Sie können auch die Registrierung eines Webhook zu einem vorhandenen Abonnement mit dem unten dargestellten Ansatz hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-238">You may also add a webhook registration to an existing subscription using the approach shown below.</span></span> <span data-ttu-id="0b6e8-239">Der *Pull*-Ansatz erfordert die Abfrage einer bestimmten Zeitspanne (nicht mehr als 24 Stunden) mit der /content-Operation.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-239">The *pull* approach requires you to query for a particular timespan (no more than 24 hours) using the /content operation.</span></span> <span data-ttu-id="0b6e8-240">Die Antwort informiert sie, welche Inhalts-Blobs während des angegebenen Zeitraums erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-240">The response will tell you which content blobs were created during the period specified.</span></span>

<span data-ttu-id="0b6e8-241">Bevor Sie einen Webhook hinzufügen, sollten Sie Folgendes beachten:</span><span class="sxs-lookup"><span data-stu-id="0b6e8-241">Before you add a webhook, be aware of the following two issues:</span></span>

1. <span data-ttu-id="0b6e8-242">Webhooks haben bei Microsoft an Bedeutung verloren, da Debugging und Fehlerbehebung schwierig sind.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-242">Webhooks are being de-emphasized by Microsoft because of the difficulty in debugging and troubleshooting.</span></span> <span data-ttu-id="0b6e8-243">In der Regel hosten Sie einen WebApi-Endpunkt, der auf eingehende Anforderungen antwortet.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-243">Typically, you would host a WebApi endpoint that responds to incoming requests.</span></span> <span data-ttu-id="0b6e8-244">Viele Kunden verwenden entweder Hosting-Umgebungen (über die sie keine vollständige Kontrolle haben) oder lokale Umgebungen (die Probleme haben, eingehende HTTP-Anforderungen zuzulassen).</span><span class="sxs-lookup"><span data-stu-id="0b6e8-244">Many customers either use hosting environments (which they don't have full control over) or on-premises environments (that have difficulty allowing incoming HTTP requests).</span></span> <span data-ttu-id="0b6e8-245">Der Support hat viele Probleme beobachtet, bei denen eingehende Anforderungen von der Office 365-Überwachungspipeline durch eine Firewall oder einen Router blockiert wurden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-245">Support has seen many problems where the incoming requests from the Office 365 auditing pipeline have been blocked by a firewall or router.</span></span> <span data-ttu-id="0b6e8-246">In diesem Fall implementiert die API einen Backoff-Algorithmus, was verwirrend sein kann und evtl. zur Deaktivierung des Webhook im Abonnement führt.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-246">In this case, the API will implement a back-off algorithm, which can be confusing and may result in disabling the webhook in the subscription.</span></span>

2. <span data-ttu-id="0b6e8-247">Der Webhook muss sofort auf eine Validierungsanforderung reagieren, nachdem der Startvorgang ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-247">The webhook must be ready to immediately respond to a validation request after the start operation is executed.</span></span> <span data-ttu-id="0b6e8-248">Wenn ein Bug in der Webhook-Anwendung vorhanden ist, schlägt die Validierung fehl, und der Webhook wird nicht aktiviert.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-248">If there is a bug in the webhook application, the validation will fail, and the webhook will not be enabled.</span></span> <span data-ttu-id="0b6e8-249">Informationen zum Schema der Validierungsanforderung finden Sie im Abschnitt „Webhook-Validierung“ in der Referenz zur Office 365-Verwaltungsaktivitäts-API.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-249">For information about the validation request schema, see the Webhook validation section in the Office 365 Management Activity API reference.</span></span> <span data-ttu-id="0b6e8-250">Sie sollten sich die Herausforderungen der Erstellung eines produktionsbereiten Webhook zur Reaktion auf Benachrichtigungen der Verwaltungsaktivitäts-API klar machen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-250">You should seriously consider the challenges in producing a production-ready webhook to respond to Management Activity API notifications.</span></span>

<span data-ttu-id="0b6e8-251">Wenn Sie einen Webhook implementieren, sollte er getestet werden, um zu verifizieren, dass der Endpunkt mit einer HTTP 200-Antwort auf die Validierungsanforderung und die normalen Benachrichtigungsanforderungen antwortet, bevor zum ersten Mal eine /start-Operation aufgerufen wird, die einen Webhook-Endpunkt angibt.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-251">If you decide to implement a webhook, it should be tested to verify that the endpoint is prepared to respond with an HTTP 200 response to both the validation request and the normal notification requests before any /start operation that specifies a webhook endpoint is called for the first time.</span></span> <span data-ttu-id="0b6e8-252">In der Regel verwenden Sie eine Testanforderung von der API, um diese Bereitschaft zu testen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-252">Typically, you would use a mocked request from the API to test this readiness.</span></span> <span data-ttu-id="0b6e8-253">Lesen Sie sorgfältig die Abschnitte Webhook-Validierung und Abrufen von Inhalt in der Referenz zur Office 365-Verwaltungsaktivitäts-API, um das Schema dieser beiden Anforderungstypen zu verstehen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-253">Carefully read and observe both the Webhook validation and Retrieving content sections in the Office 365 Management Activity API reference to understand the schema of these two types of requests.</span></span>

<span data-ttu-id="0b6e8-254">Wenn Sie ein Abonnement mit einem Webhook-Endpunkt hinzufügen möchten, fügen Sie einen Textparameter zum POST zum /start-Endpunkt hinzu; zum Beispiel:</span><span class="sxs-lookup"><span data-stu-id="0b6e8-254">To add a subscription with a webhook endpoint, add a body parameter to the POST to the /start endpoint; for example:</span></span>

```json
$body = '{
    "webhook" : {
        "address": "https://webhook.myapp.com/o365/",
        "authId": "o365activityapinotification",
        "expiration": ""
    }}'
$uri = "https://manage.office.com/api/v1.0/$tenantGUID/activity/feed//subscriptions/start?contentType=Audit.SharePoint"
Invoke-RestMethod -Method Post -uri $uri -Headers $headerParams -Body $body
```

<span data-ttu-id="0b6e8-255">Unmittelbar nach diesem Aufruf wird eine Validierungsanforderung an `https://webhook.myapp.com/o365/ …` gesendet, und es sollte ein Listener zum Antworten vorhanden sein, gemäß Beschreibung im Abschnitt Webhook-Validierung in der Referenz zur Office 365-Verwaltungsaktivitäts-API.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-255">Immediately following this call, a validation request will be sent out to `https://webhook.myapp.com/o365/ …` and there should be a listener ready to respond, as per the description in the Webhook validation section in the Office 365 Management Activity API reference.</span></span> <span data-ttu-id="0b6e8-256">Ihr Listener muss mit HTTP 200 antworten.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-256">Your listener must respond with HTTP 200.</span></span> <span data-ttu-id="0b6e8-257">Wenn Sie die /list-Operation an diesem Punkt sofort ausführen, wird der Webhook als „null“ angezeigt, bis die Validierung erfolgreich war.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-257">If you immediately run the /list operation at this point, you will not see the webhook shown as other than null until the validation has returned successfully.</span></span>

#### <a name="checking-notifications-to-webhooks"></a><span data-ttu-id="0b6e8-258">Prüfen von Benachrichtigungen an Webhooks</span><span class="sxs-lookup"><span data-stu-id="0b6e8-258">Checking notifications to webhooks</span></span>

<span data-ttu-id="0b6e8-259">Es ist wichtig, zwischen der /notifications- und der /content-Operation zu unterscheiden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-259">It's important to distinguish between the /notifications operation and the /content operation.</span></span> <span data-ttu-id="0b6e8-260">Die Prüfung der Benachrichtigungen ist nur relevant, wenn Sie mit einem Webhook-Endpunkt abonniert haben.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-260">Checking notifications is only relevant if you have subscribed with a webhook endpoint.</span></span> <span data-ttu-id="0b6e8-261">Diese Operation teilt Ihnen mit, ob Versuche zum Senden von Benachrichtigungen an Ihren Webhook erfolgreich waren.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-261">This operation will let you know if attempts to send notifications to your webhook have been successful or not.</span></span> <span data-ttu-id="0b6e8-262">Diese Operation sollte nicht zum Auflisten der verfügbaren Inhalte verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-262">This operation should not be used to list available content.</span></span> <span data-ttu-id="0b6e8-263">Um die Verfügbarkeit von Inhalten mit dem zu prüfen, was Sie bereits in Ihrem Webhook erhalten haben, verwenden Sie die /content-Operation.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-263">To cross-check the availability of content against what you may have already received in your webhook, you would use the /content operation.</span></span> <span data-ttu-id="0b6e8-264">Prüfen Sie jedoch erst mit der /notifications-Operation auf fehlgeschlagene Benachrichtigungen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-264">But be sure to first check for failed notifications using the /notifications operation.</span></span>

### <a name="requesting-content-blobs-and-throttling"></a><span data-ttu-id="0b6e8-265">Anfordern von Inhalts-Blobs und Drosselung</span><span class="sxs-lookup"><span data-stu-id="0b6e8-265">Requesting content blobs and throttling</span></span>

<span data-ttu-id="0b6e8-266">Nachdem Sie eine Liste von Inhalts-URLs erhalten haben, müssen Sie die Blobs anfordern, die von den URLs angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-266">After you've obtained a list of content URIs, you must request the blobs specified by the URIs.</span></span> <span data-ttu-id="0b6e8-267">Im Folgenden finden Sie ein Beispiel für die Anforderung eines Inhalts-Blobs (unter Verwendung des API-Endpunkts manage.office.com für Unternehmen) mit PowerShell.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-267">The following is an example of requesting a content blob (using the manage.office.com API endpoint for Enterprise organizations) using PowerShell.</span></span> <span data-ttu-id="0b6e8-268">In diesem Beispiel wird davon ausgegangen, dass Sie bereits das vorherige Beispiel im Abschnitt [Abrufen eines Zugriffstoken](#getting-an-access-token) in diesem Artikel verwendet haben, um ein Zugriffstoken zu erhalten, und die `$headerParams`-Variable entsprechend gefüllt haben.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-268">This example assumes you have already used the previous example in the [Getting an access token](#getting-an-access-token) section in this article to get an access token and have populated the `$headerParams` variable appropriately.</span></span>

```powershell
# Get a content blob
$uri = 'https://manage.office.com/api/v1.0/<<your-tenant-guid>>/activity/feed/audit/<<ContentID>$audit_sharepoint$Audit_SharePoint'
$contents = Invoke-WebRequest -Method GET -Headers $headerParams -Uri $uri
```

<span data-ttu-id="0b6e8-269">Beachten Sie die folgenden Punkte zur *$uri*-Variablen im vorherigen Beispiel:</span><span class="sxs-lookup"><span data-stu-id="0b6e8-269">Note the following things about the *$uri* variable in the previous example:</span></span>

- <span data-ttu-id="0b6e8-270">Wir haben einzelne Anführungszeichen verwendet, sodass die *$*-Symbole nicht als Variablen in PowerShell interpretiert werden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-270">We used single quotes so that the *$* symbols aren't interpreted as variables in PowerShell</span></span>

- <span data-ttu-id="0b6e8-271">Die gesamte URI wird in der *ContentUri*-Eigenschaft der Antwort auf Ihren vorherigen Aufruf des /content-Endpunkts zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-271">The entire URI will be returned in the *contentUri* property of the response to your previous call to the /content endpoint.</span></span> <span data-ttu-id="0b6e8-272">Die dargestellten Platzhaltertoken dienen nur zur Veranschaulichung.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-272">The placeholder tokens shown are just for illustration.</span></span>

<span data-ttu-id="0b6e8-273">Wenn Sie versuchen, die verfügbaren Inhalts-Blobs abzurufen, sind bei vielen Kunden (die hauptsächlich mit aktiven Mandanten arbeiten) Fehler wie folgende aufgetreten:</span><span class="sxs-lookup"><span data-stu-id="0b6e8-273">When attempting to retrieve the available content blobs, many customers (mostly working with busy tenants) have experienced errors that look like this:</span></span>

```json
Response Code 403: {'error':{'code':'AF429','message':'Too many requests. Method=GetBlob, PublisherId=00000000-0000-0000-0000-000000000000'}}
```

<span data-ttu-id="0b6e8-274">Dies liegt wahrscheinlich an der Drosselung.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-274">This is likely due to throttling.</span></span> <span data-ttu-id="0b6e8-275">Beachten Sie, das der Wert des PublisherId-Parameters wahrscheinlich darauf hinweist, dass der Client *PublisherIdentifier* in der Anforderung nicht angegeben hat.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-275">Note that the value of the PublisherId parameter likely indicates that the client didn't specify the *PublisherIdentifier* in the request.</span></span> <span data-ttu-id="0b6e8-276">Darüber hinaus sollten Sie berücksichtigen, dass der richtige Parametername *PublisherIdentifier* lautet, auch wenn *PublisherId* in den 403-Fehlerantworten aufgeführt ist.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-276">Also, keep in mind that the correct parameter name is *PublisherIdentifier* even though you see *PublisherId* listed in the 403 error responses.</span></span>

> [!NOTE]
> <span data-ttu-id="0b6e8-277">In der API-Referenz ist der *PublisherIdentifier*-Parameter in jeder Operation der API aufgelistet, sollte jedoch auch beim Abruf des Inhalts-Blob in der GET-Anforderung zur contentUri-URL eingeschlossen werden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-277">In the API reference, the *PublisherIdentifier* parameter is listed in every operation of the API, but it should also be included in the GET request to the contentUri URL when retrieving the content blob.</span></span>

<span data-ttu-id="0b6e8-278">Wenn Sie einfache API-Aufrufe zur Problembehebung ausführen (beispielsweise Prüfung, ob ein vorhandenes Abonnement aktiv ist), können Sie den *PublisherIdentifier*-Parameter auslassen. Jeder Code, der für die Produktion gedacht ist, sollte den *PublisherIdentifier*-Parameterjedoch bei jedem Aufruf aufweisen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-278">If you're doing simple API calls to troubleshoot problems (for example, checking if a given subscription is active) you can safely omit the *PublisherIdentifier* parameter, but absolutely any code that is eventually meant for production use should include the *PublisherIdentifier* parameter on every call.</span></span>

<span data-ttu-id="0b6e8-279">Wenn Sie einen Client für den Mandanten Ihres Unternehmens implementieren, ist *PublisherIdentifier* die GUID des Mandanten.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-279">If you're implementing a client for your company's tenant, the *PublisherIdentifier* is the Tenant GUID.</span></span> <span data-ttu-id="0b6e8-280">Wenn Sie eine ISV-Anwendung oder ein Add-In für mehrere Kunden erstellen, sollte *PublisherIdentifier* die Mandanten-GUID des ISVs und nicht die Mandanten-GUID des Endbenutzerunternehmens sein.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-280">If you are creating an ISV application or add-in for multiple customers, the *PublisherIdentifier* should be the ISV's Tenant GUID, and not the tenant GUID of end user's company.</span></span>

<span data-ttu-id="0b6e8-281">Wenn Sie die gültige *PublisherIdentifier* einschließen, befinden Sie sich in einem Pool, dem 60.000 Anforderungen pro Minute und Mandant zugewiesen werden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-281">If you include the valid *PublisherIdentifier*, then you will be in a pool that is allotted 60K requests per minute per tenant.</span></span> <span data-ttu-id="0b6e8-282">Dies ist eine außergewöhnlich große Anzahl von Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-282">This is an exceptionally large number of requests.</span></span> <span data-ttu-id="0b6e8-283">Wenn Sie den *PublisherIdentifier*-Parameter jedoch nicht einschließen, befinden Sie sich im allgemeinen Pool, dem 60.000 Anforderungen pro Minute für alle Mandanten zugewiesen werden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-283">However, if you don't include the *PublisherIdentifier* parameter, you will be in the general pool allotted 60K requests per minute for all tenants.</span></span> <span data-ttu-id="0b6e8-284">In diesem Fall werden Sie sehr wahrscheinlich feststellen, dass Ihre Aufrufe gedrosselt werden.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-284">In this case, you will more than likely find that your calls are getting throttled.</span></span> <span data-ttu-id="0b6e8-285">Um dies zu verhindern, fordern Sie ein Inhalts-Blob mit *PublisherIdentifier* wie folgt an:</span><span class="sxs-lookup"><span data-stu-id="0b6e8-285">To prevent this, here's how you would request a content blob using the *PublisherIdentifier*:</span></span>

```json
$contentUri = ($response.Content | ConvertFrom-Json).contentUri[0]
$uri = $contentUri + '?PublisherIdentifier=82b24b6d-0591-4604-827b-705d55d0992f'
$contents = Invoke-WebRequest -Method GET -Headers $headerParams -Uri $uri
```

<span data-ttu-id="0b6e8-286">Das vorherige Beispiel setzt voraus, dass die *$response*-Variable mit der Antwort auf eine Anforderung beim /content-Endpunkt gefüllt wurde und dass die *$headerParams*-Variable ein gültiges Zugriffstoken enthält.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-286">The previous example assumes that the *$response* variable was populated with the response to a request to the /content endpoint and that the *$headerParams* variable includes a valid access token.</span></span> <span data-ttu-id="0b6e8-287">Das Skript verwendet das erste Element im Array von Inhalts-URIs aus der Antwort und ruft dann GET auf, um dieses Blob herunterzuladen und es in der *$contents*-Variable zu platzieren.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-287">The script grabs the first item in the array of content URIs from the response and then invokes the GET to download that blob and put it in the *$contents* variable.</span></span> <span data-ttu-id="0b6e8-288">Der Code wird in der contentUri-Sammlung in einer Schleife ausgeführt, wobei GET für *contentUri* ausgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="0b6e8-288">Your code will likely loop through the contentUri collection, issuing the GET for each *contentUri*.</span></span>
